--Part 1


DROP TABLE HOME;
DROP TABLE OCCUPATION;
DROP TABLE PERSON;

CREATE TABLE HOME (
    HID CHAR(4) PRIMARY KEY,
    ADDRESS VARCHAR(200) NOT NULL
);

CREATE TABLE OCCUPATION (
    OID2 CHAR(4) PRIMARY KEY,
    TYPE VARCHAR(20),
    SALARY NUMBER(10,2) NOT NULL
);

CREATE TABLE PERSON (
    PID CHAR(4) PRIMARY KEY,
    FIRSTNAME VARCHAR(20) NOT NULL,
    LASTNAME VARCHAR(20) NOT NULL,
    FATHER_ID CHAR(4),
    MOTHER_ID CHAR(4),
    HID CHAR(4) NOT NULL,
    OID2 CHAR(4) NOT NULL,
    FOREIGN KEY (FATHER_ID) REFERENCES PERSON(PID),
    FOREIGN KEY (MOTHER_ID) REFERENCES PERSON(PID),
    FOREIGN KEY (HID) REFERENCES HOME(HID),
    FOREIGN KEY (OID2) REFERENCES OCCUPATION(OID2)
);


--Part 2


INSERT INTO HOME VALUES('H001', '123 Easy St.');
INSERT INTO HOME VALUES('H002', '56 Fake Ln.');

INSERT INTO OCCUPATION VALUES('O000', NULL, 0);
INSERT INTO OCCUPATION VALUES('O001', 'Student', 0);
INSERT INTO OCCUPATION VALUES('O002', 'Doctor', 100000);
INSERT INTO OCCUPATION VALUES('O003', 'Professor', 80000);

INSERT INTO PERSON VALUES('P001', 'Zachary', 'Aberny', NULL, NULL, 'H002', 'O000');
INSERT INTO PERSON VALUES('P002', 'Yanni', 'Aberny', NULL, NULL, 'H002', 'O000');
INSERT INTO PERSON VALUES('P003', 'Alice', 'Aberny', 'P001', 'P002', 'H001', 'O002');

INSERT INTO PERSON VALUES('P004', 'Bob', 'Bortelson', NULL, NULL, 'H001', 'O003');
INSERT INTO PERSON VALUES('P005', 'Carl', 'Aberny-Bortelson', 'P004', 'P003', 'H001', 'O001');
INSERT INTO PERSON VALUES('P006', 'Denise', 'Aberny-Bortelson', 'P004', 'P003', 'H001', 'O001');

SELECT gp.firstname FROM person gp JOIN person p ON gp.pid = p.mother_id OR gp.pid = p.father_id JOIN person c ON p.pid = c.mother_id OR p.pid = c.father_id WHERE c.firstname = 'Denise';


--Part 3


--Q1
SELECT H.ADDRESS, COUNT(*) "NUMBER OF PEOPLE LIVING" FROM HOME H
JOIN PERSON P USING(HID)
GROUP BY H.ADDRESS;

--Q2
SELECT DISTINCT GP.FIRSTNAME || ' ' || GP.LASTNAME "GRANDPARENTS FULLNAME" FROM PERSON GP
JOIN PERSON P ON GP.PID = P.MOTHER_ID OR GP.PID = P.FATHER_ID
JOIN PERSON P2 ON P.PID = P2.MOTHER_ID OR P.PID = P2.FATHER_ID;

--Q3
SELECT P.FIRSTNAME || ' ' || P.LASTNAME "FULLNAME" FROM HOME H
JOIN PERSON P USING(HID)
WHERE P.FATHER_ID IS NOT NULL OR P.MOTHER_ID IS NOT NULL;

--Q4
SELECT H.ADDRESS, MAX(O.SALARY) "HIGHEST INCOME" FROM HOME H
JOIN PERSON P USING(HID)
JOIN OCCUPATION O USING(OID2)
GROUP BY H.ADDRESS;